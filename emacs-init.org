#+AUTHOR: Jonathan Chu
#+TITLE:  My Emacs Configuration

* Appearance

** Color theme
  #+BEGIN_SRC emacs-lisp :tangle yes
    (use-package atom-one-dark-theme
      :ensure
      :config
      (load-theme 'atom-one-dark t))
  #+END_SRC

** Smart-mode-line
   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package smart-mode-line
       :ensure
       :config
       (setq sml/no-confirm-load-theme t)
       (setq sml/theme 'respectful)
       (add-hook 'after-init-hook 'sml/setup))
   #+END_SRC

* Global Configuration

  Some essential configuration.

  #+BEGIN_SRC emacs-lisp :tangle yes
    ;; set paths from shell
    (use-package exec-path-from-shell
      :ensure
      :if (memq window-system '(mac ns))
      :config
      (exec-path-from-shell-initialize))

    ;; only type 'y' or 'n' instead of 'yes' or 'no'
    (fset 'yes-or-no-p 'y-or-n-p)

    ;; no splash screen
    (setq inhibit-splash-screen t)

    ;; no message on startup
    (setq initial-scratch-message nil)

    ;; no menu bar
    (menu-bar-mode -1)

    ;; start position and frame size
    (add-to-list 'default-frame-alist '(left . 0))
    (add-to-list 'default-frame-alist '(top . 0))
    (add-to-list 'default-frame-alist '(height . 43))
    (add-to-list 'default-frame-alist '(width . 150))

    ;; M-q
    (setq fill-column 80)

    ;; no toolbar
    (when (functionp 'tool-bar-mode)
      (tool-bar-mode -1))  ;; no toolbar

    ;; disable scroll bars
    (if window-system
        (progn
          (scroll-bar-mode -1)
          (set-frame-font "Inconsolata 15"))) ;; set font

    ;; make the font more visually pleasing
    (set-face-attribute 'default nil :height 160)

    ;; nice fonts in OS X
    (setq mac-allow-anti-aliasing t)

    ;; no word wrap
    (setq-default truncate-lines 1)

    (setq-default line-spacing 4)

    ;; no tabs
    (setq-default indent-tabs-mode nil)

    ;; delete trailing whitespace in all modes
    (add-hook 'before-save-hook 'delete-trailing-whitespace)

    ;; show line number in mode line
    (line-number-mode 1)

    ;; show column number in the mode line
    (column-number-mode 1)

    ;; show extra whitespace
    (setq show-trailing-whitespace t)

    ;; ensure last line is a return
    (setq require-final-newline t)

    ;; set encoding
    (prefer-coding-system 'utf-8)

    ;; and tell emacs to play nice with encoding
    (define-coding-system-alias 'UTF-8 'utf-8)
    (define-coding-system-alias 'utf8 'utf-8)

    ;; make sure looking at most recent changes
    (global-auto-revert-mode 1)

    (setq window-combination-resize t)

    ;;keep cursor at same position when scrolling
    (setq scroll-preserve-screen-position 1)

    ;; scroll one line at a time
    (setq mouse-wheel-scroll-amount '(1 ((shift) . 1))) ;; one line at a time
    (setq mouse-wheel-progressive-speed nil) ;; don't accelerate scrolling
    (setq mouse-wheel-follow-mouse 't) ;; scroll window under mouse
    (setq scroll-step 1) ;; keyboard scroll one line at a time
    (setq scroll-conservatively 10000)

    ;; open with in original frame, not new window
    (setq ns-pop-up-frames nil)

    ;; sentences end with single space
    (setq sentence-end-double-space nil)

    ;; useful for camelCase
    (subword-mode 1)

    ;; delete selection, insert text
    (delete-selection-mode 1)

    ;; javascript
    (setq js-indent-level 4)

    ;; css
    (setq css-indent-offset 2)

    ;; prevent active process query on quit
    (require 'cl)
    (defadvice save-buffers-kill-emacs (around no-query-kill-emacs activate)
      (flet ((process-list ())) ad-do-it))

    ;; instantly display current key sequence in mini buffer
    (setq echo-keystrokes 0.02)

    ;; server mode
    (if (not server-mode)
        (server-start nil t))

    ;; cua mode
    (cua-mode t)
    (setq cua-enable-cua-keys nil)
    (setq cua-highlight-region-shift-only t)
    (setq cua-toggle-set-mark nil)

    ;; debugging
    (setq debug-on-error t)
  #+END_SRC

* Major Modes

** Lisp

*** Clojure

    #+BEGIN_SRC emacs-lisp :tangle yes
      (use-package clojure-mode
        :ensure
        :config
        (define-clojure-indent
          (defroutes 'defun)
          (GET 2)
          (POST 2)
          (PUT 2)
          (DELETE 2)
          (HEAD 2)
          (ANY 2)
          (context 2)))
    #+END_SRC



** Python

    #+BEGIN_SRC emacs-lisp :tangle yes
      (use-package python-mode
        :ensure
        :config
        (add-hook 'python-mode-hook
                  '(lambda ()
                     (setq fill-column 80)))
        (add-to-list 'auto-mode-alist '("\\.py" . python-mode)))
    #+END_SRC

** Elpy

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package elpy
       :ensure
       :config
       (elpy-enable))
   #+END_SRC


** Magit

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package magit
       :ensure
       :config
       (progn
         (setq magit-push-always-verify nil)
         (setq magit-completing-read-function 'ivy-completing-read)
         (setq magit-last-seen-setup-instructions "1.4.0"))
       :bind
       ("C-x g" . magit-status)
       ("C-c C-a" . magit-commit-amend))
   #+END_SRC

** Yasnippet

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package yasnippet
       :ensure
       :config
       (progn
         (yas-global-mode 1)
         (setq yas-snippet-dirs (append yas-snippet-dirs
                                        '("~/.emacs.d/snippets")))))
   #+END_SRC

** Web mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package web-mode
       :ensure
       :config
       (progn
         (setq web-mode-markup-indent-offset 2)
         (setq web-mode-css-indent-offset 2)
         (setq web-mode-code-indent-offset 2)
         (add-to-list 'auto-mode-alist '("\\.hb\\.html\\'" . web-mode))
         (add-to-list 'auto-mode-alist '("\\.phtml\\'" . web-mode))
         (add-to-list 'auto-mode-alist '("\\.tpl\\.php\\'" . web-mode))
         (add-to-list 'auto-mode-alist '("\\.jsp\\'" . web-mode))
         (add-to-list 'auto-mode-alist '("\\.as[cp]x\\'" . web-mode))
         (add-to-list 'auto-mode-alist '("\\.erb\\'" . web-mode))
         (add-to-list 'auto-mode-alist '("\\.html\\'" . web-mode))
         (add-to-list 'auto-mode-alist '("\\.hbs\\'" . web-mode))
         (add-to-list 'auto-mode-alist '("\\.jsx$" . web-mode))))
   #+END_SRC

** LESS CSS mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package less-css-mode
       :ensure
       :config
       (add-to-list 'auto-mode-alist '("\\.less\\'" . less-css-mode)))
   #+END_SRC

** Flycheck

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package flycheck
       :ensure
       :defer 2
       :config
       (global-flycheck-mode 1))
   #+END_SRC

** Flx-ido

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package flx-ido
       :ensure)
   #+END_SRC

** Ido mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package ido
       :config
       (progn
         (ido-mode t)
         (ido-everywhere t)
         (flx-ido-mode t)
         (setq ido-enable-flex-matching t)
         (setq ido-use-faces nil)))
   #+END_SRC

** Ido vertical mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package ido-vertical-mode
       :ensure
       :config
       (ido-vertical-mode 1)
       (setq ido-vertical-define-keys 'C-n-and-C-p-only))
   #+END_SRC

** Ido ubiquitous

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package ido-ubiquitous
       :ensure
       :config
       (ido-ubiquitous-mode 1))
   #+END_SRC

** Smex

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package smex
       :ensure
       :init
       (smex-initialize)
       :bind
       ("M-x" . smex)
       ("M-X" . smex-major-mode-commands)
       ("C-c C-c M-x" . execute-extended-command))
   #+END_SRC

** Ag

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package ag
       :ensure
       :config
       (progn
         (setq ag-highlight-search t
                ag-reuse-buffers t)))
   #+END_SRC

** Projectile

    #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package projectile
       :ensure
       :diminish ""
       :config
       (projectile-global-mode 1)
       :init
       (bind-key "s-t" 'projectile-find-file))
   #+END_SRC

** Org mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package org
       :config
       (setq org-directory "~/Dropbox/org")
       (setq org-log-done t)
       (setq org-todo-keywords
             '((sequence "TODO(t)" "|" "DONE(d)")
               (sequence "WAITING(w)" "|" "CANCELED(c)")
               (sequence "NEXT(n)" "|" "HOLD(h)")
               ))
       (setq org-todo-keyword-faces
             '(("TODO" :foreground "green" :weight bold)
               ("NEXT" :foreground "blue" :weight bold)
               ("WAITING" :foreground "orange" :weight bold)
               ("HOLD" :foreground "magenta" :weight bold)
               ("CANCELED" :foreground "red" :weight bold)))
       (setq org-completion-use-ido t)
       (setq org-startup-folded nil)
       (setq org-ellipsis "⤵"))
   #+END_SRC

** Whitespace mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package whitespace
       :config
       (progn
         (global-whitespace-mode 1)
         (setq whitespace-action '(auto-cleanup))
         (setq whitespace-style '(trailing space-before-tab indentation empty space-after-tab))))
   #+END_SRC

** Highlight brackets

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package paren
       :config
       (show-paren-mode 1))
   #+END_SRC

** Save place

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package saveplace
       :config
       (progn
         (setq-default save-place t)
         (setq save-place-file "~/.emacs.d/saved-places")))
   #+END_SRC

** Command log mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package command-log-mode
       :ensure)
   #+END_SRC

** Gitconfig Mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package gitconfig-mode
       :ensure)
   #+END_SRC

** Gitignore mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package gitignore-mode
       :ensure)
   #+END_SRC

** Git timemachine

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package git-timemachine
       :ensure)
   #+END_SRC

** Git browse file

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package github-browse-file
       :ensure)
   #+END_SRC

** Restclient mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package restclient
       :ensure)
   #+END_SRC

** Uniquify

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package uniquify
       :config
       (progn
         (setq uniquify-buffer-name-style 'reverse)
         (setq uniquify-separator " • ")
         (setq uniquify-after-kill-buffer-p t)
         (setq uniquify-ignore-buffers-re "^\\*")))
   #+END_SRC

** Make mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package make-mode
       :config
       (add-to-list 'auto-mode-alist '("\\Makefile\\'" . makefile-mode)))
   #+END_SRC

** Nav mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package nav
       :ensure
       :config
       (nav-disable-overeager-window-splitting))
   #+END_SRC

** Dired+ mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package dired+
       :ensure)
   #+END_SRC

** Dired single

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package dired-single
       :ensure)
   #+END_SRC

** Undo tree

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package undo-tree
       :ensure
       :config
       (global-undo-tree-mode 1)
       (setq undo-tree-visualizer-diff t
             undo-tree-visualizer-timestamps t))
   #+END_SRC

** Fullframe

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package fullframe
       :ensure
       :config
       (fullframe magit-status magit-mode-quit-window))
   #+END_SRC

** Recentf

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package recentf
       :config
       (setq recentf-max-saved-items 250
             recentf-max-menu-items 15
             ;; Cleanup recent files only when Emacs is idle, but not when the mode
             ;; is enabled, because that unnecessarily slows down Emacs. My Emacs
             ;; idles often enough to have the recent files list clean up regularly
             recentf-auto-cleanup 300
             recentf-exclude (list "^/var/folders\\.*"
                                   "COMMIT_EDITMSG\\'"
                                   ".*-autoloads\\.el\\'"
                                   "[/\\]\\.elpa/"
                                   "/\\.git/.*\\'"
                                   "ido.last"))
       (recentf-mode))
   #+END_SRC

** Beacon mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package beacon
       :ensure
       :config
       (beacon-mode 1)
       (setq beacon-push-mark 35)
       (setq beacon-color "#61AFEF"))
   #+END_SRC

** Cider

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package cider
       :ensure
       :config
       (setq nrepl-log-messages t)
       (setq nrepl-hide-special-buffers t)
       (add-hook 'cider-mode-hook 'eldoc-mode))
   #+END_SRC

** Expand region

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package expand-region
       :ensure
       :bind
       ("C-=" . er/expand-region))
   #+END_SRC

** Markdown mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package markdown-mode
       :ensure
       :mode "\\.md\\'")
   #+END_SRC

** Rainbow delimiters

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package rainbow-delimiters
       :ensure
       :config
       (add-hook 'prog-mode-hook 'rainbow-delimiters-mode))
   #+END_SRC

** Smartparens mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package smartparens
       :ensure
       :init
       (smartparens-global-mode t)
       :config
       (progn
         (sp-local-pair 'web-mode "{%" "%}")
         (use-package smartparens-config)
         (setq sp-autoskip-closing-pair 'always
               ;; Don't kill the entire symbol on C-k
               sp-hybrid-kill-entire-symbol nil)))
   #+END_SRC

** Paredit mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package paredit
       :ensure
       :config
       (autoload 'enable-paredit-mode "paredit" t)
       (add-hook 'emacs-lisp-mode-hook 'enable-paredit-mode)
       (add-hook 'eval-expression-minibuffer-setup-hook 'enable-paredit-mode)
       (add-hook 'ielm-mode-hook 'enable-paredit-mode)
       (add-hook 'lisp-mode-hook 'enable-paredit-mode)
       (add-hook 'lisp-interaction-mode-hook 'enable-paredit-mode)
       (add-hook 'scheme-mode-hook 'enable-paredit-mode)
       (add-hook 'clojure-mode-hook 'enable-paredit-mode)
       (add-hook 'python-mode-hook
                 (lambda () (local-set-key (kbd "C-k") 'paredit-kill))))
   #+END_SRC

** Latex preview pane mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package latex-preview-pane
       :ensure
       :config
       (latex-preview-pane-enable))
   #+END_SRC

** Swiper

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package swiper
       :init
       (ivy-mode 1)
       :ensure
       :bind
       ("C-s" . swiper)
       ("C-r" . swiper)
       ("C-c C-r" . ivy-resume)
       :config
       (setq ivy-use-virtual-buffers t)
       (setq ivy-format-function 'ivy-format-function-arrow)
       (advice-add 'swiper :after 'recenter))
   #+END_SRC

** Ace window

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package ace-window
       :ensure
       :init
       (setq aw-keys '(?a ?s ?d ?f ?j ?k ?l))
       :bind
       (("C-x C-o" . ace-window)))
   #+END_SRC

** Avy

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package avy
       :ensure
       :init
       (setq avy-keys '(?a ?s ?d ?e ?f ?h ?j ?k ?l ?n ?m ?v ?r ?u))
       :config
       (avy-setup-default)
       (setq avy-background t)
       (setq avy-styles-alist '((avy-goto-word-or-subword-1 . de-brujin)))
       :bind
       ("C-c j" . avy-goto-word-or-subword-1))
   #+END_SRC

** Scratch

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package scratch
       :ensure
       :config
       (autoload 'scratch "scratch" nil t))
   #+END_SRC

** Flyspell

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package flyspell
       :config
       (add-hook 'text-mode-hook 'flyspell-mode))
   #+END_SRC

** Anzu

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package anzu
       :ensure
       :config
       (global-anzu-mode 1)
       (set-face-attribute 'anzu-mode-line nil :foreground "yellow" :weight 'bold)
       :bind
       (("M-%" . anzu-query-replace)
        ("C-M-%" . anzu-query-replace-regexp)))
   #+END_SRC

** Org bullets (custom)

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package org-bullets
       :load-path "vendor/"
       :config
       (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1))))
   #+END_SRC

** Clj refactor

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package clj-refactor
       :ensure
       :config
       (defun my-clojure-mode-hook ()
         (clj-refactor-mode 1)
         (yas-minor-mode 1) ; for adding require/use/import
         (cljr-add-keybindings-with-prefix "C-c C-m"))
       (add-hook 'clojure-mode-hook 'my-clojure-mode-hook))
   #+END_SRC

** Aggressive indent mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package aggressive-indent
       :ensure
       :init
       (add-hook 'emacs-lisp-mode-hook 'aggressive-indent-mode)
       (add-hook 'clojure-mode-hook 'aggressive-indent-mode))
   #+END_SRC

** Paradox

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package paradox
       :ensure
       :config
       (setq paradox-execute-asynchronously t))
   #+END_SRC

** Counsel

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package counsel
       :ensure
       :bind
       ("C-c g" . counsel-git-grep))
   #+END_SRC

** Easy kill

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package easy-kill
       :ensure
       :config
       (global-set-key [remap kill-ring-save] 'easy-kill))
   #+END_SRC

** Fix word

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package fix-word
       :ensure
       :bind
       (("M-u" . fix-word-upcase)
        ("M-l" . fix-word-downcase)
        ("M-c" . fix-word-capitalize)))
   #+END_SRC

** Evil mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package evil :ensure)
   #+END_SRC

** JSCS mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package jscs
       :ensure
       :config
       (autoload 'jscs-indent-apply "jscs" nil t)
       (autoload 'jscs-fix "jscs" nil t)
       (autoload 'jscs-fix-run-before-save "jscs" nil t)
       (add-hook 'js-mode-hook #'jscs-indent-apply)
       (add-hook 'js2-mode-hook #'jscs-indent-apply)
       (add-hook 'js-mode-hook #'jscs-fix-run-before-save)
       (add-hook 'js2-mode-hook #'jscs-fix-run-before-save)
       (add-hook 'js3-mode-hook #'jscs-fix-run-before-save))
   #+END_SRC

** Origami mode

   #+BEGIN_SRC emacs-lisp :tangle yes
     (use-package origami
       :ensure
       :config
       (global-origami-mode t)
       :bind
       (("s-[" . origami-close-node-recursively)
        ("s-]" . origami-open-node-recursively)
        ("M-[" . origami-close-all-nodes)
        ("M-]" . origami-open-all-nodes)))
   #+END_SRC
